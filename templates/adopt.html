<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animals.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/adoptForm.css') }}">
    <title>Animals</title>
</head>
<body style="font-family: 'Fredoka', sans-serif; font-weight: 400; font-style: normal; margin: 0; padding: 0; color: black;">
    <nav style="display: flex; align-items: center; background-color: #b4dcd4; padding: 10px; margin: 0; justify-content: center;">
        <img src="{{url_for('static', filename='images/C4C_Logo.png')}}" style="height: 50px;">
        <ul style="list-style-type: none; display: inline-flex; gap: 30px;">
            <a href="/" style="text-decoration: none; color: black;">Home</a>
            <a href="animals" style="text-decoration: none; color: black">Adopt</a>
            <a href="fundraisers" style=" text-decoration: none; color: black">Fundraisers</a>
            <a href="donate" style=" text-decoration: none; color: black">Donate</a>
            <a href="/application_status" style="text-decoration: none; color: black">Application Status</a>
        </ul>
    </nav>

    <div style=" display: flex; justify-content: center; flex-direction: column">
        <h3 style="font-weight: 500; font-size: xx-large; text-align: center; text-transform: capitalize;">{{animal_type}}</h3>
        <div style="justify-content: center; display: flex; flex-direction: row; gap: 20px; text-align: center; height: 30px;">
            <a href="animals" style="width: 125px; background-color: #0047ab; color: white; text-decoration: none; text-align: center; align-content: center; border-radius: 20px;">All animals</a>
            <a href="mammals" style="width: 125px; background-color: #0047ab; color: white; text-decoration: none; text-align: center; align-content: center; border-radius: 20px;">Mammals</a>
            <a href="exotics" style="width: 125px; background-color: #0047ab; color: white; text-decoration: none; text-align: center; align-content: center; border-radius: 20px;">Exotics</a>
            <a href="fish" style="width: 125px; background-color: #0047ab; color: white; text-decoration: none; text-align: center; align-content: center; border-radius: 20px;">Fish</a>
        </div>
        <div style="display: flex; flex-direction: row; width:inherit; margin: 20px; gap: 20px;">
            <div style="background-color: #b4dcd4; display:flex; flex-direction: column; width: 20%;border-radius: 30px; gap: 20px; padding: 20px; height: fit-content;">
                <form method="POST" action="{{animal_type}}">
                    <p style="font-size: medium; font-weight: 500;">Filter Animals</p>
                    <div class="filter-group">
                        <label>Sort by shelter</label>
                        <select name="shelter_locations" id="shelter_locations">
                            <option value="None">All locations</option>
                            {% for location in locations %}
                                <option value="{{location.ShelterName}}">{{location.ShelterName}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <br>
                    <div class="filter-group">
                        <label>Sort by pet age</label>
                            {% for age in pet_ages %}
                            <label for="{{age.Age}}">
                                <input type="checkbox" name="selected_ages" value="{{age.Age}}">
                                {{age.Age}}
                            </label>
                            {% endfor %}
                    </div>
                    <br>
                    <div style="justify-content: center;" class="submit">
                        <button type="submit" >Apply filters</button>
                    </div>
                </form> 
                
            </div>
            <div style=" width: 80%; gap: 20px; display: grid; grid-template-columns: 1fr 1fr 1fr;">
                {% for animal in animals %}
                <div style="background-color: #e6eddc;  border-radius: 30px; padding: 20px;box-shadow: 5px 5px 10px rgba(90, 90, 90, 0.5);">
                    <div style="width: auto; height: 30vh;">
                        <img src="{{animal.Photo}}" style="width: 100%; height: 100%;">
                    </div>
                    <p style="font-size: medium; font-weight: 500;">{{animal.Name}}</p>
                    <p>Species: {{animal.Species}}</p>
                    <p>Age: {{animal.Age}}</p>
                    <p>{{animal.ShelterLocation}}</p>
                    <button type="button" class="apply-btn" onclick="openAdoptModal(this)"
                        data-pet-id="{{ animal.PetID }}"
                        data-desc="{{ animal.Description }}"
                        data-name="{{ animal.Name }}"
                        data-age="{{ animal.Age }}"
                        data-species="{{ animal.Species }}"
                        data-diet="{{ animal.Diet }}"
                        data-photo="{{ animal.Photo }}"
                        data-health="{{ animal.HealthRecords }}" 
                        data-weight="{{ animal.MammalWeight }}"
                        data-weight="{{ animal.ExoticWeight }}"                
                        data-water="{{ animal.WaterType }}"     
                        data-habitat="{{ animal.HabitatRequirements }}"                        
                    >
                    <style>
                    .apply-btn:hover{
                        opacity: 0.8;
                    }
                    </style>
                        Apply for adoption
                    </button>
                </div>
                {% endfor%}
            </div>
        </div>

    </div>

    
<div id="adopt-modal" style="display: none;">
    <div class="Adoption-Form-Overlay">
        <div class="Adoption-Box">


            <!--Pet Info-->

   

            <div class="pet-info">
                <h1 class="pet-name" id="modal-pet-name">{% if reopen_modal and animal %} {{ animal.Name }} {% endif %}</h1>
                <p class="pet-id">PetID: <span id="modal-pet-id">{% if reopen_modal and animal %} {{ animal.PetID }} {% endif %}</span></p>                     
     
                <div class="pet-image">
                    <img id="modal-photo" class="pet-photo" src="{% if reopen_modal and animal %} {{ animal.Photo }} {% endif %}" alt="/static/images/pet_placeholder.png"> 
                </div>
                <div class="pet-details">

                    <!--General Info-->
                    <div class="general-info">
                        <p><b>Description: </b><span id="modal-pet-desc">{% if reopen_modal and animal %}{{ animal.Description }}{% endif %}</span></p>

                        <p><b>Approx. Age: </b><span id="modal-pet-age">{% if reopen_modal and animal %}{{ animal.Age }}{% endif %}</span></p>
                        
                        <p><b>Species/Breed: </b><span id="modal-pet-species">{% if reopen_modal and animal %}{{ animal.Species }}{% endif %}</span></p>
            
                        <p><b>Diet: </b><span id="modal-pet-diet">{% if reopen_modal and animal %}{{ animal.Diet }}{% endif %}</span></p>
                    </div>
                    
                    <!--Type specific info-->
                    <div class="other-info">
                        <p><b>Other Info:</b></p>
                        
                        {% if animal is defined and animal %}
                            <!--Showing Mammal Specific Info-->
                            {% if animal.HealthRecords %}
                                <p><b>Health Records:</b> {{ animal.HealthRecords }}</p>
                                <p><b>Weight:</b> {{ animal.MammalWeight }} kg</p>
                            {% endif %}

                            <!--Showing Fish Specific Info-->
                            {% if animal.WaterType %}
                                <p><b>Water Type:</b> {{ animal.WaterType }}</p>
                            {% endif %}

                            <!--Showing Exotic Specific Info-->
                            {% if animal.HabitatRequirements %}
                                <p><b>Habitat Requirements:</b> {{ animal.HabitatRequirements }}</p>
                                <p><b>Weight:</b> {{ animal.ExoticWeight }} kg</p>
                            {% endif %}
                        {% endif %}            
                    </div>
                    

                </div>
            </div>

            <!--Personal Information Form-->
            <form class="form-section" id="infoForm" method="POST" action="/form_submit" novalidate>
                 <div class="header">
                    <div class="titles">
                        <h1>Adoption Application</h1>
                        <p>Please fill out the form below: </p>
                    </div>
                </div>

                <div class="section">
                    <div class="name-row">
                        <div class="name-field">
                            <label>First Name</label>
                            <input name="first_name"  value="{{ first_name|default('') }}" >
                        </div>
                        <div class="name-field">
                            <label>Last Name</label>
                            <input name="last_name" value="{{ last_name|default('') }}">
                        </div>

                    </div>
                    

                    <div class="address-row">
                        <div class="address-field building-no">
                            <label for="building_no">Building No.</label>
                            <input id="building_no" name="building_no" type="text" autocomplete="off" value="{{ building_no|default('') }}"/>
                        </div>

                        <div class="address-field street">
                            <label for="street">Street</label>
                            <input id="street" name="street" type="text" autocomplete="nope" value="{{ street|default('') }}"/>
                        </div>

                        <div class="address-field postal-code">
                            <label for="postal_code">Postal Code</label>
                            <input id="postal_code" name="postal_code" type="text" value="{{ postal_code|default('') }}"/>
                        </div>                        
                        
                    </div>    

                    <div class="address-row2">
                        <div class="address-field city">
                            <label for="city">City</label>
                            <input id="city" name="city" type="text" value="{{ city|default('') }}"/>
                        </div>

                        <div class="address-field province">
                            <label for="province">Province</label>
                            <input id="province" name="province" type="text" value="{{ province|default('') }}"/>
                        </div>                            
                    </div>

                    <div class="contact-row">
                        <div class="contact-field">
                            <label>Email Address</label>
                            <input type="email" name="email" value="{{ email|default('') }}">
                        </div>
                        <div class="contact-field">
                            <label>Phone Number: </label>
                            <input name="phone_number" type="number" value="{{ phone_number|default('') }}">
                        </div>
                    </div>

                    <label>Driver's License</label>
                    <input name="license_number" type="number" value="{{ license_number|default('') }}">    

                    <input type="hidden" name="pet_id" id="modal-pet-id-input"
                        value="{% if reopen_modal and animal %}{{ animal.PetID }}{% endif %}">

                </div>

                <br>
                <!--ERROR MESSAGE-->
                {% if error %}
                    <div class="error" role="alert">
                        {{ error }}
                    </div>
                {% endif %}

                <!--NAV Buttons-->
                <div class="actions">
                    <a href="/animals" class="cancel-btn">Cancel</a>
                    <button type="submit" class="continue-btn">Submit</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="adopt-submit-modal" style="display: none;">
    <div class="ThankYou-Overlay">
        <div class="ThankYou-Box">
            <div class="ThankYou-Header">
                <img class="ThankYou-Logo" src="/static/images/C4C_Logo.png" alt="Logo">
                <div class="title">
                    <h1>Care for Critters</h1>               
                </div>
            </div>

            <div class="thank-msg">
                <div class="section">
                    <h2>Thank you for submitting an <br> 
                        adoption application to Care for Critters. Your <br>
                        application is currently being processed. We will notify <br>
                        you via Email!</h2>
                </div>
            </div>

            <div class="ThankYou-Actions">
                <button class="close-btn" onclick="closeAdoptModal()">Close</button>
            </div>
        </div>
    </div>
</div>

<footer style="background-color: #b4dcd4; align-content: center; display: flex; gap: 20%; justify-content: center; padding: 10px;">
    <div style="align-content: center;">
        <img src="{{url_for('static', filename='images/C4C_Logo.png')}}" style="height: 50px;">
    </div>
    <div style="line-height: 14px; align-content: center;">
        <a href="/" style="font-size: small; text-decoration: none;">Home</a>
        <br>
        <a style="font-size: small;">About</a>
        <br>
        <a style="font-size: small;">Contact Us</a>
    </div>
    <div style="align-content: center;">
        <a href="login" style="font-size: small; text-decoration: none;">Supervisor Login</a>
    </div>
</footer>

<script>
    function openAdoptModal(button) {
        const petId = button.getAttribute('data-pet-id');
        const name = button.getAttribute('data-name');
        const desc = button.getAttribute('data-desc');        
        const age = button.getAttribute('data-age');
        const species = button.getAttribute('data-species');
        const photo = button.getAttribute('data-photo');
        const diet = button.getAttribute('data-diet');

        // Type Specific
        const health = button.getAttribute('data-health');
        const water = button.getAttribute('data-water');
        const mweight = button.getAttribute('data-mweight');
        const eweight = button.getAttribute('data-eweight');
        const habitat = button.getAttribute('data-habitat');        

        // Fill fields
        document.getElementById('modal-pet-name').textContent = name;
        document.getElementById('modal-pet-id').textContent = petId;
        document.getElementById('modal-pet-desc').textContent = desc;
        document.getElementById('modal-pet-age').textContent = age;
        document.getElementById('modal-pet-species').textContent = species;
        document.getElementById('modal-pet-diet').textContent = diet;
        document.getElementById('modal-photo').src = photo;

        // Hidden input for form_submit
        document.getElementById('modal-pet-id-input').value = petId;

        let otherHTML = "";

        if (health) {
            otherHTML += `<p><b>Health Records:</b> ${health}</p>`;
            if (mweight) {
                otherHTML += `<p><b>Weight:</b> ${mweight} kg</p>`;
            }
        }

        if (water) {
            otherHTML += `<p><b>Water Type:</b> ${water}</p>`;
        }

        if (habitat) {
            otherHTML += `<p><b>Habitat Requirements:</b> ${habitat}</p>`;
            if (eweight) {
                otherHTML += `<p><b>Weight:</b> ${eweight} kg</p>`;
            }
        }

        // Put it into the Other Info box
        const otherInfoDiv = document.querySelector('.other-info');
        if (otherInfoDiv) {
            otherInfoDiv.innerHTML = `<h3><b>Other Info:</b></h3>` + otherHTML;
        }

        // Show modal
        document.getElementById('adopt-modal').style.display = 'block';
    }

    function closeAdoptModal() {
        document.getElementById('adopt-modal').style.display = 'none';
        document.getElementById('adopt-submit-modal').style.display = 'none';
    }



    // Optional: close when clicking outside, same as manage_applications
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('adopt-submit-modal');        
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
</script>

<!--Thank You page for submitting an adoption application-->
{% if submitted == '1' %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('adopt-submit-modal').style.display = 'block';
    });
</script>
{% endif %}

{% if reopen_modal %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    // Open the modal again
    document.getElementById("adopt-modal").style.display = "block";
});
</script>
{% endif %}
</body>
</html>